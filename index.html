<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Schafkopf Abrechnung – Final</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>

<body class="bg-slate-900 text-white min-h-screen font-sans">
  <div id="root">
    <div class="flex items-center justify-center min-h-screen">
       <p class="text-slate-500 animate-pulse">Initialisiere Abrechnung...</p>
    </div>
  </div>

  <script>
    const { useState, useEffect, createElement: el } = React;

    function App() {
      const [players, setPlayers] = useState([]);
      const [name, setName] = useState('');
      const [winners, setWinners] = useState([]);
      const [losers, setLosers] = useState([]);
      const [points, setPoints] = useState('10');
      const [mode, setMode] = useState('normal'); // 'normal' oder 'solo'

      // Daten laden
      useEffect(() => {
        const p = localStorage.getItem('sk_data_v4');
        if (p) setPlayers(JSON.parse(p));
      }, []);

      // Daten speichern
      useEffect(() => {
        localStorage.setItem('sk_data_v4', JSON.stringify(players));
      }, [players]);

      const addPlayer = () => {
        if (!name.trim() || players.length >= 6) return;
        setPlayers([...players, { name: name.trim(), points: 0 }]);
        setName('');
      };

      const kickPlayer = (idx) => {
        if (confirm("Spieler entfernen?")) {
          setPlayers(players.filter((_, i) => i !== idx));
          setWinners([]); setLosers([]);
        }
      };

      const toggleList = (list, setList, n) => {
        if (list.includes(n)) setList(list.filter(x => x !== n));
        else setList([...list, n]);
      };

      const recordGame = () => {
        const val = parseInt(points);
        if (!val || winners.length === 0 || losers.length === 0) return alert("Gewinner/Verlierer wählen!");

        const newPlayers = players.map(p => {
          let change = 0;
          if (mode === 'normal') {
            if (winners.includes(p.name)) change = val;
            if (losers.includes(p.name)) change = -val;
          } else {
            // SOLO LOGIK
            if (winners.length === 1 && winners.includes(p.name)) change = val * losers.length;
            else if (winners.length === 1 && losers.includes(p.name)) change = -val;
            if (losers.length === 1 && losers.includes(p.name)) change = -(val * winners.length);
            else if (losers.length === 1 && winners.includes(p.name)) change = val;
          }
          return { ...p, points: p.points + change };
        });

        setPlayers(newPlayers);
        setWinners([]); setLosers([]);
      };

      return el('div', { className: 'max-w-xl mx-auto p-4 space-y-6' },
        // Header
        el('h1', { className: 'text-3xl font-black text-emerald-500 text-center py-4' }, 'SCHAFKOPF PRO'),
        
        // Spieler hinzufügen
        el('div', { className: 'bg-slate-800 p-4 rounded-2xl shadow-lg' },
          el('label', { className: 'text-xs text-slate-400 uppercase font-bold' }, 'Spieler hinzufügen'),
          el('div', { className: 'flex gap-2 mt-2' },
            el('input', {
              className: 'flex-1 bg-slate-700 rounded-xl px-4 py-2 outline-none focus:ring-2 focus:ring-emerald-500',
              value: name, onChange: e => setName(e.target.value), placeholder: 'Name...'
            }),
            el('button', { className: 'bg-emerald-600 hover:bg-emerald-500 px-6 rounded-xl font-bold', onClick: addPlayer }, '+')
          )
        ),

        // Spiel-Modus
        el('div', { className: 'flex bg-slate-800 p-1 rounded-xl' },
          el('button', { 
            className: `flex-1 py-2 rounded-lg font-bold transition ${mode === 'normal' ? 'bg-emerald-600' : 'text-slate-500'}`,
            onClick: () => { setMode('normal'); setWinners([]); setLosers([]); }
          }, 'Sauspiel'),
          el('button', { 
            className: `flex-1 py-2 rounded-lg font-bold transition ${mode === 'solo' ? 'bg-purple-600' : 'text-slate-500'}`,
            onClick: () => { setMode('solo'); setWinners([]); setLosers([]); }
          }, 'Solo/Wenz')
        ),

        // Auswahl Gewinner/Verlierer
        el('div', { className: 'grid grid-cols-2 gap-4' },
          el('div', { className: 'space-y-2' },
            el('p', { className: 'text-[10px] text-emerald-500 font-bold uppercase' }, 'Gewinner'),
            ...players.map(p => el('button', {
              key: p.name,
              className: `w-full text-left px-3 py-2 rounded-lg text-sm font-bold border ${winners.includes(p.name) ? 'bg-emerald-600 border-emerald-400' : 'bg-slate-800 border-slate-700 text-slate-400'}`,
              onClick: () => { if(!losers.includes(p.name)) toggleList(winners, setWinners, p.name) }
            }, p.name))
          ),
          el('div', { className: 'space-y-2' },
            el('p', { className: 'text-[10px] text-red-500 font-bold uppercase' }, 'Verlierer'),
            ...players.map(p => el('button', {
              key: p.name,
              className: `w-full text-left px-3 py-2 rounded-lg text-sm font-bold border ${losers.includes(p.name) ? 'bg-red-600 border-red-400' : 'bg-slate-800 border-slate-700 text-slate-400'}`,
              onClick: () => { if(!winners.includes(p.name)) toggleList(losers, setLosers, p.name) }
            }, p.name))
          )
        ),

        // Punkte & Speichern
        el('div', { className: 'flex gap-3' },
          el('input', {
            type: 'number', className: 'w-24 bg-slate-800 rounded-xl px-4 py-3 text-xl font-bold text-center',
            value: points, onChange: e => setPoints(e.target.value)
          }),
          el('button', { 
            className: 'flex-1 bg-white text-slate-900 rounded-xl font-black text-lg hover:bg-emerald-400 transition',
            onClick: recordGame 
          }, 'EINTRAGEN')
        ),

        // Rangliste
        el('div', { className: 'space-y-2 pt-4' },
          el('p', { className: 'text-xs text-slate-500 font-bold uppercase' }, 'Aktueller Stand'),
          ...players.map((p, i) =>
            el('div', { key: i, className: 'flex justify-between items-center bg-slate-800/50 px-4 py-3 rounded-xl border border-white/5' },
              el('div', { className: 'flex items-center gap-3' },
                el('button', { className: 'text-slate-600 hover:text-red-500 text-xs', onClick: () => kickPlayer(i) }, '✕'),
                el('span', { className: 'font-bold' }, p.name)
              ),
              el('span', { className: `font-mono font-bold ${p.points >= 0 ? 'text-emerald-400' : 'text-red-400'}` }, 
                (p.points / 100).toFixed(2) + '€'
              )
            )
          )
        ),

        // Reset
        el('button', { 
          className: 'w-full text-slate-600 text-xs py-10 hover:text-red-500',
          onClick: () => { if(confirm("ALLES LÖSCHEN?")) { localStorage.clear(); location.reload(); }}
        }, 'Komplette Sitzung zurücksetzen')
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(el(App));
  </script>
</body>
</html>
